import{_ as i,c as a,o as s,ag as t}from"./chunks/framework.DRADY2L-.js";const r="/img/qs-jwt-qseow-rule-1.png",m=JSON.parse('{"title":"QSEoW: Using JWTs in Security Rules","description":"","frontmatter":{"head":[["link",{"rel":"canonical","href":"https://qs-jwt.ptarmiganlabs.com/guide/security-rules"}],["meta",{"property":"og:url","content":"https://qs-jwt.ptarmiganlabs.com/guide/security-rules"}],["meta",{"property":"og:title","content":"QSEoW: Using JWTs in Security Rules"}],["meta",{"name":"twitter:title","content":"QSEoW: Using JWTs in Security Rules"}],["meta",{"property":"og:description","content":"Easily create Qlik Sense JWTs"}],["meta",{"name":"twitter:description","content":"Easily create Qlik Sense JWTs"}]]},"headers":[],"relativePath":"guide/security-rules.md","filePath":"guide/security-rules.md","lastUpdated":1757058720000}'),l={name:"guide/security-rules.md"};function n(o,e,c,u,h,d){return s(),a("div",null,[...e[0]||(e[0]=[t('<h1 id="qseow-using-jwts-in-security-rules" tabindex="-1">QSEoW: Using JWTs in Security Rules <a class="header-anchor" href="#qseow-using-jwts-in-security-rules" aria-label="Permalink to &quot;QSEoW: Using JWTs in Security Rules&quot;">​</a></h1><p>Any claim embedded in the JWT can be used in QSEoW security rules.</p><p>The claims are available as <code>user.environment.&lt;claim name&gt;</code> in the security rules.<br> You must write the security rule manually in the Conditions text box (i.e. the authoring tool doesn&#39;t work for JWT claims).</p><h2 id="example-security-rule" tabindex="-1">Example Security Rule <a class="header-anchor" href="#example-security-rule" aria-label="Permalink to &quot;Example Security Rule&quot;">​</a></h2><p>A rule that gives access to a specific stream for all JWTs where the <code>group</code> claim is &quot;group 2&quot; can look like this:</p><p><img src="'+r+`" alt="QSEoW security rule using data from a JWT"></p><h2 id="available-jwt-claims" tabindex="-1">Available JWT Claims <a class="header-anchor" href="#available-jwt-claims" aria-label="Permalink to &quot;Available JWT Claims&quot;">​</a></h2><p>When you create a JWT using qs-jwt, the following claims are available in security rules:</p><h3 id="standard-claims" tabindex="-1">Standard Claims <a class="header-anchor" href="#standard-claims" aria-label="Permalink to &quot;Standard Claims&quot;">​</a></h3><ul><li><code>user.environment.userId</code> - The user ID from <code>--userid</code></li><li><code>user.environment.userDirectory</code> - The user directory from <code>--userdir</code></li><li><code>user.environment.name</code> - The display name from <code>--username</code></li><li><code>user.environment.email</code> - The email address from <code>--useremail</code></li></ul><h3 id="group-claims" tabindex="-1">Group Claims <a class="header-anchor" href="#group-claims" aria-label="Permalink to &quot;Group Claims&quot;">​</a></h3><p>Groups specified with <code>--groups</code> are available as arrays:</p><ul><li><code>user.environment.group</code> - Array of all groups</li></ul><h3 id="example-security-rule-conditions" tabindex="-1">Example Security Rule Conditions <a class="header-anchor" href="#example-security-rule-conditions" aria-label="Permalink to &quot;Example Security Rule Conditions&quot;">​</a></h3><h4 id="grant-access-based-on-user-directory" tabindex="-1">Grant access based on user directory <a class="header-anchor" href="#grant-access-based-on-user-directory" aria-label="Permalink to &quot;Grant access based on user directory&quot;">​</a></h4><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">user.environment.userDirectory </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;COMPANY&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h4 id="grant-access-based-on-group-membership" tabindex="-1">Grant access based on group membership <a class="header-anchor" href="#grant-access-based-on-group-membership" aria-label="Permalink to &quot;Grant access based on group membership&quot;">​</a></h4><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">user.environment.group.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">indexOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;admin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h4 id="grant-access-based-on-email-domain" tabindex="-1">Grant access based on email domain <a class="header-anchor" href="#grant-access-based-on-email-domain" aria-label="Permalink to &quot;Grant access based on email domain&quot;">​</a></h4><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">user.environment.email.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">indexOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;@company.com&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h4 id="complex-rule-combining-multiple-claims" tabindex="-1">Complex rule combining multiple claims <a class="header-anchor" href="#complex-rule-combining-multiple-claims" aria-label="Permalink to &quot;Complex rule combining multiple claims&quot;">​</a></h4><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(user.environment.userDirectory </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;COMPANY&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> and user.environment.group.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">indexOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;power-users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">or user.environment.group.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">indexOf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;admin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span></code></pre></div><h2 id="security-rule-types" tabindex="-1">Security Rule Types <a class="header-anchor" href="#security-rule-types" aria-label="Permalink to &quot;Security Rule Types&quot;">​</a></h2><p>JWT claims can be used in various types of security rules:</p><h3 id="stream-access" tabindex="-1">Stream Access <a class="header-anchor" href="#stream-access" aria-label="Permalink to &quot;Stream Access&quot;">​</a></h3><p>Control which streams users can access based on JWT claims.</p><h3 id="app-access" tabindex="-1">App Access <a class="header-anchor" href="#app-access" aria-label="Permalink to &quot;App Access&quot;">​</a></h3><p>Grant or deny access to specific applications.</p><h3 id="system-access" tabindex="-1">System Access <a class="header-anchor" href="#system-access" aria-label="Permalink to &quot;System Access&quot;">​</a></h3><p>Control access to QMC, Hub, or other system components.</p><h2 id="best-practices" tabindex="-1">Best Practices <a class="header-anchor" href="#best-practices" aria-label="Permalink to &quot;Best Practices&quot;">​</a></h2><h3 id="principle-of-least-privilege" tabindex="-1">Principle of Least Privilege <a class="header-anchor" href="#principle-of-least-privilege" aria-label="Permalink to &quot;Principle of Least Privilege&quot;">​</a></h3><ul><li>Only include necessary claims in JWTs</li><li>Design security rules to grant minimal required access</li><li>Regularly review and update security rules</li></ul><h3 id="group-based-access" tabindex="-1">Group-Based Access <a class="header-anchor" href="#group-based-access" aria-label="Permalink to &quot;Group-Based Access&quot;">​</a></h3><ul><li>Use groups rather than individual user IDs where possible</li><li>Maintain consistent group naming conventions</li><li>Document group purposes and access levels</li></ul><h3 id="testing-security-rules" tabindex="-1">Testing Security Rules <a class="header-anchor" href="#testing-security-rules" aria-label="Permalink to &quot;Testing Security Rules&quot;">​</a></h3><ul><li>Test security rules with different JWT configurations</li><li>Verify that rules work as expected in development before deploying</li><li>Document security rule logic and dependencies</li></ul><h3 id="jwt-claim-design" tabindex="-1">JWT Claim Design <a class="header-anchor" href="#jwt-claim-design" aria-label="Permalink to &quot;JWT Claim Design&quot;">​</a></h3><ul><li>Use meaningful group names that reflect organizational structure</li><li>Include role-based claims when appropriate</li><li>Consider future scalability when designing claim structure</li></ul><h2 id="troubleshooting" tabindex="-1">Troubleshooting <a class="header-anchor" href="#troubleshooting" aria-label="Permalink to &quot;Troubleshooting&quot;">​</a></h2><h3 id="common-issues" tabindex="-1">Common Issues <a class="header-anchor" href="#common-issues" aria-label="Permalink to &quot;Common Issues&quot;">​</a></h3><ol><li><strong>Claims not available</strong>: Ensure claims are properly included in JWT creation</li><li><strong>Case sensitivity</strong>: JWT claims are case-sensitive in security rules</li><li><strong>Array handling</strong>: Remember that groups are arrays, use <code>indexOf()</code> to check membership</li><li><strong>Special characters</strong>: Be careful with special characters in claim values</li></ol><h3 id="debugging-tips" tabindex="-1">Debugging Tips <a class="header-anchor" href="#debugging-tips" aria-label="Permalink to &quot;Debugging Tips&quot;">​</a></h3><ol><li><strong>Use the Security Rule Debugger</strong> in QMC to test rules</li><li><strong>Check JWT contents</strong> using online JWT decoders (development only!)</li><li><strong>Start with simple rules</strong> and gradually add complexity</li><li><strong>Log security rule evaluation</strong> for troubleshooting</li></ol><h2 id="security-considerations" tabindex="-1">Security Considerations <a class="header-anchor" href="#security-considerations" aria-label="Permalink to &quot;Security Considerations&quot;">​</a></h2><h3 id="jwt-security" tabindex="-1">JWT Security <a class="header-anchor" href="#jwt-security" aria-label="Permalink to &quot;JWT Security&quot;">​</a></h3><ul><li>JWTs contain unencrypted data - treat them as credentials</li><li>Use short expiration times to limit exposure</li><li>Rotate signing certificates regularly</li><li>Never include sensitive data in JWT claims</li></ul><h3 id="security-rule-security" tabindex="-1">Security Rule Security <a class="header-anchor" href="#security-rule-security" aria-label="Permalink to &quot;Security Rule Security&quot;">​</a></h3><ul><li>Regularly audit security rules for correctness</li><li>Test security rules thoroughly before deploying</li><li>Maintain documentation of security rule logic</li><li>Consider the impact of security rule changes on existing users</li></ul><h2 id="related-topics" tabindex="-1">Related Topics <a class="header-anchor" href="#related-topics" aria-label="Permalink to &quot;Related Topics&quot;">​</a></h2><ul><li><a href="/guide/concepts">JWT Concepts</a></li><li><a href="/guide/qseow-examples">QSEoW Examples</a></li><li><a href="/guide/api-usage">API Usage</a></li></ul>`,51)])])}const g=i(l,[["render",n]]);export{m as __pageData,g as default};
